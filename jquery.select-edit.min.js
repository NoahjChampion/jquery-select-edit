!function(a){"use strict";var b,c="selectEdit",d=27,e=38,f=40,g=39,h=37,i=13,j=a(document),k=a(window),l="select-edit",m=l+"__select",n=m+"_open",o=m+"_empty",p=m+"__current",q=l+"-drop",r=q+"_show-up",s=q+"_show-down",t=q+"_show",u=l+"__tooltip",v=l+"__results",w=v,x=v+"__item",y=x+"_hover",z=x+"_selected",A=5,B={up:r,down:s},C=Object.prototype.toString,D=function(a){return"function"==typeof a},E=function(a){return"[object String]"==C.call(a)},F=function(a){return"[object Array]"==C.call(a)},G=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b};b=function(b,d){return this.$select=a(b),this.options=d,this.$select.is("select")?(this.$select.attr("autocomplete","off"),this.isMultiple=this.$select.prop("multiple"),this._fixSelect(),void this.initialize()):(console.warn(c,"Sorry, only select element!"),!1)},b.DEFAULTS={tmplContent:'<div role="form"><span role="button"><span role="link"></span></span></div>',tmplGroup:'<div role="group"></div>',tmplTooltip:'<div role="tooltip"></div>',tmplList:'<div role="list"></div>',tmplListbox:'<div role="listbox"></div>',tmplListitem:'<div role="listitem"%attrs%>%text%</div>',placeholderTitle:null,appendBody:!1,classHide:l+"-hide",classForm:l,classButton:m,classButtonOpen:n,classButtonEmpty:o,classButtonText:p,classGroup:q,classGroupShow:t,classTooltip:u,classList:v,classListbox:w,classListitem:x,classListitemHover:y,classListitemSelected:z,callItemToggle:null,callBeforeChange:null},b.prototype={Constructor:b,isOpen:!1,isGenerateItems:!1,initialize:function(){var b=this.options;this._initHtml(),this._hideSelect(),this.$select.attr("tabindex","-1").on("change."+c,a.proxy(this._onChangeSelect,this)),this.$fakeInput=a('<input tabindex="0">').addClass(b.classHide).on("focus keydown blur",a.proxy(this._onEventFake,this)).insertBefore(this.$select),this._actualizeButtonText(),this.$content.insertAfter(this.$select),this.$button.on("click."+c+" touchstart."+c,a.proxy(this.toggle,this)),k.on("resize."+c,this.updateListPosition.bind(this))},destroy:function(){this.hide(),this.$content.remove(),this.$fakeInput.remove(),this._showSelect(),this.$select.data(c,!1),this.$select.off("."+c),k.off("."+c)},_onEventFake:function(a){switch(a.type){case"focus":this.show();break;case"blur":}},_onChangeSelect:function(){return this._actualizeListItems(),this._actualizeButtonText(),!0},_actualizeListItems:function(){var b=this.options.classListitemSelected,c=this.getListItems(),d=this.getSelected(),e={};d.each2(function(){e[this.value]=this}),c.removeClass(b).each2(function(){var c=this.getAttribute("data-value");e[c]&&a(this).addClass(b)})},_actualizeButtonText:function(){var a=this.options.placeholderTitle||this._getSelectedText();this.$buttonText.text(a||this.$select.attr("placeholder")),this.$button.toggleClass(this.options.classButtonEmpty,!a)},toggle:function(){return this.isOpen?this.hide():this.show(),!1},updateListPosition:function(){var a=this.$content.offset(),b=this.$group.outerHeight(),c=k.height(),d=this.$content.outerHeight(),e=k.scrollTop(),f=c-a.top-d-A,g=0,h="",i=a.top-e>b,j=f>b;!j&&i?(g=-b-A,h="up"):(g=d+A,h="down"),this.options.appendBody&&(a.top+=g,this.$group.offset(a)),this.setMod(h,B,this.$group)},setMod:function(a,b,c){this.removeModElement(c,b).addClass(b[a])},removeModElement:function(a,b){return a.removeClass(G(b).join(" "))},show:function(){return this.isOpen?!0:(j.trigger("event-show."+c),this._generateItems(),this.$group.addClass(this.options.classGroupShow).appendTo(this.options.appendBody&&document.body||this.$content).focus(),this.updateListPosition(),this.isOpen=!0,void this._eventsGroup())},hide:function(){this.isOpen=!1,this._eventsGroup(),this.$group.removeClass(this.options.classGroupShow),this.options.appendBody&&this.$group.offset({top:0,left:0}),this.$group.detach()},_eventsGroup:function(){var b=this.options;this.isOpen?(this.$group.on("click."+c+" touchstart."+c,a.proxy(this._clickGroup,this)).on("click."+c+" touchstart."+c,"."+b.classListitem,a.proxy(this._clickListItem,this)).on("mouseover."+c+" mouseout."+c+" touchstart."+c,"."+b.classListitem,a.proxy(this._hoverItem,this)),j.on("keydown."+c,a.proxy(this._keydownGroup,this)).on("click."+c+" touchstart."+c,a.proxy(this._clickDocument,this)).on("event-show."+c,a.proxy(this.hide,this))):(this.$group.off("."+c),j.off("."+c)),this.toggleButton()},toggleButton:function(){this.$button.toggleClass(this.options.classButtonOpen,this.isOpen)},_keydownGroup:function(a){if(!this.isOpen)return!0;switch(a.which){case f:case e:return this._navGroupItem(a.which===f),!1;case g:case h:return this._navGroupItem(a.which===g),!1;case d:this.hide();break;case i:this._toggleListItemHover(),!this.isMultiple&&this.hide()}},_navGroupItem:function(a){var b,c=this.options,d=c.classListitemHover,e=this.getListItems(),f=this._getListItemsHover(e);a?(b=f.length&&f.next(),b=b.length&&b||e.first()):(b=f.length&&f.prev(),b=b.length&&b||e.last()),f.removeClass(d),b.addClass(d)},_clickGroup:function(){return!1},_clickDocument:function(){this.hide()},_toggleListItemHover:function(){var a=this._getListItemsHover();a.length&&this._switchListItem(a,!a.hasClass(this.options.classListitemSelected))},_hoverItem:function(b){var c=this.getListItems(),d=this.options.classListitemHover,e=a(b.currentTarget);switch(b.type){case"mouseover":case"touchstart":"touchstart"===b.type&&c.removeClass(d),e.addClass(d);break;case"mouseout":c.removeClass(d)}},_clickListItem:function(b){var c=this.options,d=c.classListitemSelected,e=a(b.currentTarget),f=!e.hasClass(d);this.isMultiple||(this.getListItems().removeClass(d),this.hide()),this._switchListItem(e,f)},_switchListItem:function(a,b){var c=this.options.callBeforeChange,d=!0,e=a.data("value"),f={value:e,selected:b};return D(c)&&(d=c(f)),this.$select.trigger("beforeChange",f),d?(a.toggleClass(this.options.classListitemSelected,b),this._switchOption(a.data("value"),b),void this._actualizeButtonText()):!1},_switchOption:function(a,b){var c=this.$select.find('option[value="'+a+'"]'),d=this.options.callItemToggle,e={value:a,selected:b};c.prop("selected",b),!b&&c.removeAttr("selected"),D(d)&&d(e),this.$select.trigger("change").trigger("itemToggle",e)},getListItems:function(){return this.$listItems||a()},_getListItemsHover:function(a){return a=a||this.getListItems(),a.filter("."+this.options.classListitemHover)},_getSelectedText:function(){var b="";return this.getSelected().each(function(){b+=(b?", ":"")+a(this).text()}),b},getSelected:function(){var b=this.$select.val(),c=a();if(E(b))c=this.$select.find('[value="'+b+'"]');else if(F(b)){var d=this.$select.find("[value]");b.forEach(function(a){var b=d.filter('[value="'+a+'"]');c=c&&c.add(b)||b})}return c},_hideSelect:function(){this.$select.addClass(this.options.classHide)},_showSelect:function(){this.$select.removeClass(this.options.classHide)},_initHtml:function(){var b=this.options;this.$content=a(b.tmplContent).addClass(b.classForm),this.$button=this.$content.find("[role=button]").addClass(b.classButton),this.$buttonText=this.$content.find("[role=link]").addClass(b.classButtonText),this.$group=a(b.tmplGroup).addClass(b.classGroup),this.$list=this.isMultiple?a(b.tmplListbox).addClass(b.classListbox):a(b.tmplList).addClass(b.classList),this.$listItem=a(b.tmplListitem).addClass(b.classListitem),this.$listItems=a(),this.options.tooltip&&(this.$tooltip=a(b.tmplTooltip).addClass(b.classTooltip).html(this.options.tooltip),this.$group.append(this.$tooltip)),this.$group.append(this.$list)},_generateItems:function(){if(this.isGenerateItems)return!0;var b,c=(this.options,a(),this.$listItem),d=c[0],e="",f=document.createElement("div"),g=this.$select.contents("option");f.appendChild(d),b=f.innerHTML,g.each2(function(){var a=this.innerHTML,c=this.value,d=b;return a?(d=d.replace("%attrs%",' data-value="'+c+'"'),d=d.replace("%text%",a),void(e+=d)):!0}),this.$listItems=a(e),this.$list.html(this.$listItems),this._actualizeListItems(),this.isGenerateItems=!0},_fixSelect:function(){var a=this.$select.find(":not([value])");a.length||this.isMultiple||this.$select.prepend('<option selected="selected"></option>')}},a.fn[c]=function(d){return this.each(function(){var e=a(this),f=e.data(),g=e.data(c),h=a.extend({},b.DEFAULTS,f,"object"==typeof d&&d);g||e.data(c,g=new b(this,h)),"string"==typeof d&&D(g[d])&&("_"!==d.charAt(0)?g[d]():console.warn(c,"Do not use private methods!"))})},a.fn[c].Constructor=b,Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;++c)a.call(b,this[c],c,this)}),"undefined"==typeof a.fn.each2&&a.extend(a.fn,{each2:function(b){for(var c=a([0]),d=-1,e=this.length;++d<e&&(c.context=c[0]=this[d])&&b.call(c[0],d,c)!==!1;);return this}})}(jQuery);